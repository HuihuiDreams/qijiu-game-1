<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å®‰å®šå³°é‡‡è´­å‡è¯å¼•å‘çš„æƒ¨æ¡ˆ VNé£</title>
    <!-- 1. åŠ è½½ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* å¼•å…¥æ ‡å‡†å­—ä½“å’Œè¡Œä¹¦å­—ä½“ (Ma Shan Zheng) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Serif+SC:wght@400;700&family=Ma+Shan+Zheng&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0d0d1a;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }
        #root {
            width: 100%;
            height: 100%;
        }
        .character-visual {
            object-fit: contain;
            width: 100%;
            height: 100%;
            image-rendering: optimizeQuality;
        }
        .dialogue-text {
            font-family: 'Noto Serif SC', serif;
        }
        .font-calligraphy {
            font-family: 'Ma Shan Zheng', cursive;
        }
        .dialogue-box-container {
            background-color: rgba(13, 13, 26, 0.85);
            backdrop-filter: blur(5px);
            border-top: 3px solid #67e8f9;
            box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.5), 0 -2px 10px rgba(103, 232, 249, 0.2);
            transition: all 0.3s ease;
        }
        .speaker-tag {
            background-color: rgba(13, 13, 26, 0.95);
            border: 1px solid #67e8f9;
            box-shadow: 0 0 15px rgba(103, 232, 249, 0.15);
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .scrollbar-thin::-webkit-scrollbar { width: 4px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background-color: rgba(103, 232, 249, 0.3); border-radius: 20px; }
        
        /* å¼ºåˆ¶ 16:9 å®¹å™¨ */
        #game-frame {
            aspect-ratio: 16 / 9;
            width: 100%; 
            height: auto;
            max-width: 100vw;
            max-height: 100vh;
        }
        @media (min-aspect-ratio: 16/9) {
            #game-frame {
                width: auto;
                height: 100%;
            }
        }
    </style>
    
    <!-- 2. åŠ è½½ React, ReactDOM å’Œ Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- å›¾æ ‡ç»„ä»¶ ---
        const Icon = ({ children, size = 24, className = 'text-current' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const AlertTriangle = (props) => (<Icon {...props}><path d="M10.29 3.86L2.39 20.34c-.21.46-.21.99 0 1.45.21.46.66.75 1.15.75h15.93c.49 0 .94-.29 1.15-.75.21-.46.21-.99 0-1.45L13.71 3.86c-.21-.46-.66-.75-1.15-.75s-.94.29-1.15.75z" /><line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /></Icon>);
        const Heart = (props) => (<Icon {...props}><path d="M19 14c1.49-1.46 3-3.23 3-5.5C22 6.07 19.93 4 17.5 4S13 7 13 7s-1.5-3-4.5-3C6.07 4 4 6.07 4 8.5c0 2.27 1.51 4.04 3 5.5l7 7 7-7z" /></Icon>);
        const RefreshCcw = (props) => (<Icon {...props}><path d="M21 12A9 9 0 0 0 6.19 6.19l-.78-.78" /><path d="M3 12a9 9 0 0 0 14.81 5.81l.78.78" /><path d="M2 17H6v4" /><path d="M22 7H18V3" /></Icon>);
        const ShieldAlert = (props) => (<Icon {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /><path d="M12 8v4" /><path d="M12 16h.01" /></Icon>);
        const Volume2 = (props) => (<Icon {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><path d="M15.54 8.46a5 5 0 0 1 0 7.07" /></Icon>);
        const VolumeX = (props) => (<Icon {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><line x1="23" y1="9" x2="17" y2="15" /><line x1="17" y1="9" x2="23" y2="15" /></Icon>);
        const Save = (props) => (<Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></Icon>);
        const Upload = (props) => (<Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></Icon>);
        const Menu = (props) => (<Icon {...props}><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="18" x2="21" y2="18" /></Icon>);
        
        // **èµ„æº URL**
        // ğŸŸ¢ æ–¹æ¡ˆ A: CDN (Preview)
        const BG_QINGJING = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/bk.JPG'; 
        const BG_QIANCAO = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game--gas1@main/qiancao.jpg'; 
        const BG_BAMBOO_NIGHT = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game--gas1@main/bamboonight.jpg'; 
        const BG_COLD_SPRING = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game--gas1@main/coldspring.jpg';   
        const BG_BEDROOM = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game--gas1@main/bedroom.jpg';         
        const BG_RUIN = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game--gas1@main/ruin.jpg';               
        const BG_LINGXI = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game--gas1@main/lingxicave.jpg'; 
        const BG_NUANHONG = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game--gas1@main/nuanhongge.jpg'; 

        const SHEN_QINGQIU_PIC = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/shenqingqiu.png'; 
        const YUE_QINGYUAN_PIC = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/yueqingyuan.png'; 
        const BGM_URL = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/baheng.mp3'; 
        const ENDING_B_PIC = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/Image%20(1).png';
        const START_SCREEN_PIC = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/qijiu_start_screen%20(1).jpg';

        const SE_BOOM = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/boom.mp3';
        const SE_FAN = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/fan.mp3';
        const SE_SPLASH = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/splash.mp3';
        const SE_CLOTH = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/cloth.mp3';
        const SE_SWORD = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/sword.mp3';
        const SE_MAGIC = 'https://cdn.jsdelivr.net/gh/HuihuiDreams/qijiu-game-1@main/magic.mp3';
        const SE_PIPA = 'https://placehold.co/pipa.mp3'; // å ä½ç¬¦

        // ğŸ”´ æ–¹æ¡ˆ B: æœ¬åœ°ç›¸å¯¹è·¯å¾„ (éƒ¨ç½²ç”¨)
        /*
        const BG_QINGJING = './bk.JPG'; 
        const BG_QIANCAO = './qiancao.jpg'; 
        const BG_BAMBOO_NIGHT = './bamboonight.jpg';
        const BG_COLD_SPRING = './coldspring.jpg';
        const BG_BEDROOM = './bedroom.jpg';
        const BG_RUIN = './ruin.jpg';
        const BG_LINGXI = './lingxicave.jpg';
        const BG_NUANHONG = './nuanhongge.jpg';
        
        const SHEN_QINGQIU_PIC = './shenqingqiu.png'; 
        const YUE_QINGYUAN_PIC = './yueqingyuan.png'; 
        const BGM_URL = './baheng.mp3'; 
        const ENDING_B_PIC = './Image (1).png';
        const START_SCREEN_PIC = './qijiu_start_screen (1).jpg';

        const SE_BOOM = './boom.mp3';
        const SE_FAN = './fan.mp3';
        const SE_SPLASH = './splash.mp3';
        const SE_CLOTH = './cloth.mp3';
        const SE_SWORD = './sword.mp3';
        const SE_MAGIC = './magic.mp3';
        const SE_PIPA = './pipa.mp3';
        */

        // --- å…¨å±€å¸¸é‡ ---
        const SAVE_KEY_MANUAL = 'qijiu_manual_v10'; 
        const SAVE_KEY_AUTO = 'qijiu_auto_v10';

        // --- éŸ³ä¹æ§åˆ¶ Hook ---
        const useAudio = (url) => {
            const audioRef = React.useRef(new Audio(url));
            audioRef.current.loop = true;
            audioRef.current.volume = 0.5;
            const [isPlaying, setIsPlaying] = React.useState(false);
            
            const play = () => {
                if (!audioRef.current.src || audioRef.current.src === window.location.href) {
                     audioRef.current.src = url;
                }
                audioRef.current.play().then(() => setIsPlaying(true)).catch(() => setIsPlaying(false));
            };
            const pause = () => {
                audioRef.current.pause();
                setIsPlaying(false);
            };
            const toggle = () => {
                isPlaying ? pause() : play();
            };
            React.useEffect(() => {
                audioRef.current.src = url;
                return () => { audioRef.current.pause(); audioRef.current.removeAttribute('src'); };
            }, [url]);
            return { isPlaying, play, pause, toggle };
        };

        // --- 2. å‰§æœ¬æ•°æ® ---
        const SCENES = {
            start: { id: 'start', bg: 'bg-slate-900', },
            chapter1: {
                id: 'chapter1',
                lines: [
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆæ‰‹ä¸­æŠ˜æ‰‡â€œå•ªâ€åœ°åˆä¸Šï¼Œçœ‰é—´èšç€æˆ¾æ°”ï¼‰æ²¡æœ‰ï¼Ÿæœ¨å¸ˆå¼Ÿï¼Œä½ åƒè‰å³°å·ç§°æ±‡é›†å¤©ä¸‹çµè¯ï¼Œå¦‚ä»Šæˆ‘è¦èƒ½åŠ©æˆ‘ç»“ä¸¹çªç ´çš„è¯ï¼Œä½ å´æ¨ä¸‰é˜»å››ï¼Ÿ", mood: 'angry', bg: BG_QIANCAO, sound: SE_FAN },
                    { speaker: 'æœ¨æ¸…èŠ³', text: "ã€€ã€€æ²ˆå¸ˆå…„ï¼Œå¹¶éå¸ˆå¼Ÿä¸ç»™ã€‚åªæ˜¯ä¿®è¡Œè®²ç©¶å¾ªåºæ¸è¿›ã€‚è‹¥ç”¨çŒ›è¯å¼ºè¡Œæ‹”é«˜ï¼Œåªæ€•æ¬²é€Ÿåˆ™ä¸è¾¾ã€‚", mood: 'neutral' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå†·ç¬‘ä¸€å£°ï¼‰æ¬²é€Ÿåˆ™ä¸è¾¾ï¼Ÿæˆ‘çœ‹æŸ³æ¸…æ­Œç²¾è¿›ç¥é€Ÿï¼Œä¹Ÿæ²¡è§ä»–å‡ºä»€ä¹ˆå²”å­ã€‚æ€ä¹ˆï¼Œä»–æ˜¯å¤©ä¹‹éª„å­ï¼Œæˆ‘å°±æ˜¯æœ½æœ¨ä¸€å—ï¼Ÿ", mood: 'angry' },
                    { speaker: 'æœ¨æ¸…èŠ³', text: "ã€€ã€€ï¼ˆå¹æ°”ï¼Œå–å‡ºè´´ç€ç¬¦ç®“çš„é’ç“·å°ç“¶ï¼‰è¿™æ˜¯æ–°ç‚¼çš„â€œå›ºå…ƒç´«é‡‘ä¸¹â€ã€‚æ­¤è¯æ€§çƒˆï¼Œèƒ½çŸ­æ—¶é—´æ¿€å‘æ½œèƒ½â€¦â€¦", mood: 'worried' },
                    { speaker: 'æœ¨æ¸…èŠ³', text: "ã€€ã€€ä¸è¿‡å¸ˆå¼Ÿå¿…é¡»è¨€æ˜ï¼Œè¿™æ‰¹è¯çš„å‡ å‘³è¾…æ–™æ˜¯å®‰å®šå³°æ–°è¿›çš„ï¼Œå°šå¸ˆå…„è™½ä¿¡èª“æ—¦æ—¦è¯´æ˜¯ä¸Šå“ï¼Œä½†æˆ‘å°šæœªå®Œå…¨éªŒè¿‡è¯æ€§â€¦â€¦", mood: 'worried' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆä¸€æŠŠå¤ºè¿‡è¯ç“¶ï¼‰å¤Ÿäº†ã€‚åªè¦æœ‰ç”¨å°±è¡Œã€‚", mood: 'angry' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€ä»–æ— æ³•å¿å—åŒè¾ˆå¸ˆå…„å¼Ÿéƒ½å…ˆä»–ç»“ä¸¹ã€‚ä»–è¦å˜å¼ºï¼Œå“ªæ€•é¥®é¸©æ­¢æ¸´ã€‚", mood: 'narrative' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€å¤œæ·±äº†ï¼Œæ¸…é™å³°ç«¹èˆã€‚ç«¹æ—åœ¨é£ä¸­æ²™æ²™ä½œå“ã€‚æ²ˆæ¸…ç§‹å±é€€ä¼—å¼Ÿå­ï¼Œè®¾ä¸‹ä¸¤é“ç¦åˆ¶ï¼Œä»°å¤´å°†é‚£é¢—ç´«é‡‘ä¸¹è¯åå…¥è…¹ä¸­ã€‚", mood: 'narrative', bg: BG_BAMBOO_NIGHT },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆé—·å“¼ä¸€å£°ï¼Œé¢å¤´æ¸—å‡ºå†·æ±—ï¼‰å””â€¦â€¦", mood: 'pain' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€é‚£ç«æ²¡çƒ§åœ¨ç»è„‰ï¼Œå…¨çƒ§è¿›äº†éª¨é«“è¡€æ¶²ï¼Œç›´å†²å°è…¹ï¼Œå¸¦ç€éš¾ä»¥è¨€å–»åˆä»¤äººç¾è€»çš„ç‡¥çƒ­ã€‚", mood: 'narrative' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆèœ·ç¼©èµ·èº«å­ï¼Œæ‰‹æŒ‡æ­»æŠ“èº«ä¸‹ç«¹å¸­ï¼‰è¯¥æ­»â€¦â€¦æœ¨æ¸…èŠ³â€¦â€¦å°šæ¸…åâ€¦â€¦", mood: 'shame' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€èº«ä½“åƒè¢«ä¸‡èšå™¬å’¬ï¼Œåˆç—’åˆç—›ï¼Œæ›´å¯æ€•çš„æ˜¯é‚£ç§æ·±å¤„æ³›ä¸Šæ¥çš„ç©ºè™šæ„Ÿã€‚", mood: 'narrative' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€æ¸…ç§‹å¸ˆå¼Ÿï¼Ÿæˆ‘åˆšå¾—äº†äº›æå¥½çš„é›¨å‰é¾™äº•ï¼Œæƒ³ç€ä½ åº”è¯¥è¿˜æ²¡æ­‡â€¦â€¦", mood: 'gentle' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆæµ‘èº«ä¸€åƒµï¼Œæ­»æ­»å’¬ä½å˜´å”‡ï¼‰ï¼ˆå†…å¿ƒï¼‰å²³æ¸…æºã€‚ç»ä¸èƒ½è®©ä»–çœ‹è§è‡ªå·±è¿™å‰¯æ¨¡æ ·ï¼ç»ä¸ï¼æ»šâ€¦â€¦", mood: 'shame' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆå£°éŸ³æŸ“ä¸Šç„¦æ€¥ï¼‰æ¸…ç§‹å¸ˆå¼Ÿï¼Ÿä½ æ€ä¹ˆäº†ï¼Ÿæˆ‘è¿›æ¥äº†ï¼", mood: 'worried' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€ã€éŸ³æ•ˆã€‘ç °ï¼çµåŠ›ç ´é—¨ã€‚", mood: 'system', sound: SE_BOOM },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆå‡ æ­¥å†²åˆ°æ¦»å‰ï¼‰è¿™å‘³é“â€¦â€¦åƒæœºæ•£ï¼Ÿï¼å°ä¹ï¼", mood: 'shocked' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆçœ¼ç¥æ¶£æ•£ï¼Œç—›è‹¦åœ°æ’•æ‰¯é¢†å£ï¼‰åˆ«â€¦â€¦åˆ«ç¢°æˆ‘â€¦â€¦", mood: 'shame' },
                ]
            },
            chapter2: {
                id: 'chapter2',
                lines: [
                    { speaker: 'æ—ç™½', text: "ã€€ã€€å¯’æ½­å†·æ³‰ã€‚å²³æ¸…æºæŠ±ç€æ²ˆæ¸…ç§‹è·³å…¥æ± ä¸­ï¼Œè¯•å›¾å¸®ä»–åŒ–è§£è¯æ€§ã€‚ç„¶è€Œä¸€ç‚·é¦™è¿‡å»ï¼Œæ²ˆæ¸…ç§‹ä½“å†…çƒ­åº¦æœªé€€ï¼Œåå› å¤–ç•Œæå¯’åˆºæ¿€ï¼Œé€¼å¾—è¯æ€§ç–¯ç‹‚åæ‰‘ã€‚", mood: 'narrative', bg: BG_COLD_SPRING, sound: SE_SPLASH },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆçŒ›åœ°å–·å‡ºä¸€å£é²œè¡€ï¼‰å™—â€”â€”", mood: 'pain' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€çœ¼è§’ã€é¼»ä¸‹ã€è€³å­”ï¼Œç«Ÿéƒ½æ¸—å‡ºäº†ç»†ç»†è¡€ä¸ã€‚ä¸ƒçªæµè¡€ã€‚è¿™æ˜¯å³å°†çˆ†ä½“è€Œäº¡çš„å¾å…†ã€‚", mood: 'narrative' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆæŠ±ç€ä»–çš„æ‰‹å‰§çƒˆé¢¤æŠ–ï¼‰ï¼ˆå†…å¿ƒï¼‰å†·æ³‰æ²¡ç”¨ã€‚è¯å¤ªçƒˆï¼Œå·²å…¥éª¨é«“ã€‚", mood: 'sorrow' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆå†…å¿ƒï¼‰è‹¥ä¸ç–è§£ï¼Œå°ä¹ä¼šæ²¡å‘½çš„ã€‚çœŸçš„ä¼šæ­»ã€‚", mood: 'sorrow' },
                ]
            },
            choice1: {
                id: 'choice1',
                question: "ç”Ÿæ­»æŠ‰æ‹©ï¼šå²³æ¸…æºçœ‹ç€ç—›è‹¦ä¸‡åˆ†çš„æ²ˆæ¸…ç§‹ï¼Œå¿…é¡»åšå‡ºå†³å®šã€‚",
                options: [
                    { id: 'A', text: "å³ä½¿ä»–ä¼šæ­»ï¼Œä¹Ÿä¸èƒ½è¶äººä¹‹å±", subtext: "ï¼ˆç»“å±€ï¼šé˜´é˜³ä¸¤éš”ï¼‰", style: "gray" },
                    { id: 'B', text: "æ¨æˆ‘ä¹Ÿå¥½ï¼Œæ€æˆ‘ä¹Ÿç½¢ï¼Œåªè¦ä½ æ´»ç€", subtext: "ï¼ˆè¿›å…¥å‰§æƒ…ä¸»çº¿ï¼‰", style: "gold" }
                ]
            },
            endingBE1: { 
                id: 'endingBE1', 
                text: "ã€€ã€€å²³æ¸…æºæœ€ç»ˆæ²¡æœ‰è¶Šé›·æ± ä¸€æ­¥ã€‚é‚£ä¸€å¤œï¼Œæ¸…é™å³°çš„ç«¹èˆå¡Œäº†ä¸€åŠã€‚æ²ˆæ¸…ç§‹çˆ†ä½“è€Œäº¡ï¼Œå²³æ¸…æºèµ°ç«å…¥é­”ï¼Œè‹ç©¹å±±æ´¾åŒå£çš†æŠ˜ã€‚\n\nã€Bad End: é˜´é˜³ä¸¤éš”ã€‘", 
                mood: 'bad' 
            },
            chapter3: {
                id: 'chapter3',
                lines: [
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆçº¢ç€çœ¼ï¼Œå°†äººçŒ›åœ°æŠ±èµ·ï¼‰æ¨æˆ‘ä¹Ÿå¥½ï¼Œæ€æˆ‘ä¹Ÿç½¢â€¦â€¦åªè¦ä½ æ´»ç€ã€‚", mood: 'dark', bg: BG_BEDROOM },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€æŒé—¨å¯æ®¿ï¼Œç»“ç•Œè½ä¸‹ã€‚è‚Œè‚¤ç›¸äº²ç¬é—´ï¼Œç”œè…»é¦™æ°”å½»åº•å¼•çˆ†ä¸€åˆ‡ã€‚æ²ˆæ¸…ç§‹æœ¬èƒ½åœ°å°†ä»–å½“æˆå”¯ä¸€æ•‘èµï¼Œæ­»æ­»ç¼ ä½å²³æ¸…æºè„–é¢ˆã€‚", mood: 'narrative' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆéš¾å—åœ°è¹­ç€ï¼Œçœ¼æ³ªå¤§é¢—æ»šè½ï¼‰â€¦â€¦ä¸ƒå“¥â€¦â€¦æ•‘æˆ‘â€¦â€¦ä¸ƒå“¥â€¦â€¦å¥½éš¾å—â€¦â€¦", mood: 'shame' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆçœ¼åº•å¢¨è‰²ç¿»æ¶Œï¼‰å°ä¹â€¦â€¦ä¸ƒå“¥æ•‘ä½ â€¦â€¦ä¸ƒå“¥è¿™å°±ç»™ä½ â€¦â€¦", mood: 'dark' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€è¡£è¡«å°½è£‚ï¼Œæ»¡å®¤è’å”ã€‚è¿™æ˜¯ä¸€åœºåä¸ºæ•‘èµçš„å‡Œè¿Ÿã€‚æ²ˆæ¸…ç§‹åœ¨è¯åŠ›é©±ä½¿ä¸‹å±•ç°å‡ºä»æœªè§è¿‡çš„åªšæ€ï¼Œå²³æ¸…æºåˆ™åœ¨æ²ˆæ¸…ç§‹ä¸€å£°å£°å˜è°ƒçš„â€œä¸ƒå“¥â€ä¸­ï¼Œå½»åº•ç–¯é­”ã€‚", mood: 'narrative', sound: SE_CLOTH },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€ç¿Œæ—¥æ¸…æ™¨ã€‚å¯æ®¿ä¸€ç‰‡ç‹¼è—‰ã€‚æ²ˆæ¸…ç§‹åœ¨ä¸€é˜µé…¸ç—›ä¸­é†’æ¥ï¼Œè®°å¿†å¦‚æ½®æ°´å›ç¬¼ã€‚", mood: 'narrative' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆçœ‹ç€èº«ä¾§ç†Ÿç¡çš„å²³æ¸…æºï¼Œè„¸è‰²æƒ¨ç™½ï¼‰ï¼ˆå†…å¿ƒï¼‰å¤ªå¯ç¬‘äº†ã€‚å¤ªä¸‹è´±äº†ã€‚", mood: 'despair' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå†…å¿ƒï¼‰æ˜¨æ™šé‚£åœºè’å”ä¸­ï¼Œæˆ‘ç«Ÿæ„Ÿåˆ°ä¸€ä¸æ»¡è¶³ã€‚æˆ‘ç«Ÿç„¶â€¦â€¦è¿˜æ˜¯çˆ±ç€è¿™ä¸ªæ¨äº†åŠè¾ˆå­çš„äººã€‚", mood: 'despair' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€é€ƒã€‚", mood: 'despair' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€æ²ˆæ¸…ç§‹æŠ“äº†ä»¶å¤–è¢ï¼Œç‹¼ç‹ˆé€ƒç¦»è‹ç©¹å±±ã€‚", mood: 'system' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆé†’æ¥é¢å¯¹ç©ºè¡çš„æ€€æŠ±ï¼Œå¿ƒå¤´ä¸€æ…Œï¼‰å°ä¹ï¼Ÿ", mood: 'worried' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€æ²¡æœ‰ã€‚å“ªé‡Œéƒ½æ²¡æœ‰ã€‚å²³æ¸…æºçœ‹ç€æ»¡åœ°ç‹¼è—‰â€”â€”ç¢è£‚çš„é’è¡«ã€æŸ“è¡€é”¦è¢«ã€‚ä»–æ„¿å—è¿™ä»½æ¨ï¼Œè¿˜ä»¥ä¸ºåªè¦è´Ÿè´£ï¼Œæˆ–è®¸â€¦â€¦å¯å°ä¹é€ƒäº†ã€‚", mood: 'narrative' },
                    { speaker: 'æœ¨æ¸…èŠ³', text: "ã€€ã€€ï¼ˆè„¸è‰²ç…ç™½ï¼‰æŒâ€¦â€¦æŒé—¨å¸ˆå…„ï¼Ÿè¿™â€¦â€¦ä¸»æ–™æ²¡é—®é¢˜ï¼Œä½†è¾…æ–™â€œé¾™æ¶è‰â€è¢«æ¢æˆäº†â€œåˆæ¬¢åƒå¶çº¢â€ï¼è¿™æ˜¯åˆæ¬¢å®—æµå‡ºçš„åŠ£è´¨å‚¬æƒ…è¾…æ–™â€¦â€¦æ˜¯å®‰å®šå³°é‡‡è´­çš„ã€‚", mood: 'worried', bg: BG_QIANCAO }, 
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆé¢è‰²é˜´é¸·ï¼‰æŸ¥ï¼è¿™åˆ°åº•æ˜¯ä»€ä¹ˆã€‚ï¼ˆæŠŠä¸¹è¯ç¢ç‰‡æ‰”åˆ°æ¡Œä¸Šï¼‰", mood: 'dark' },
                    { speaker: 'æœ¨æ¸…èŠ³', text: "ã€€ã€€ï¼ˆè„¸è‰²ç…ç™½ï¼‰æŒâ€¦â€¦æŒé—¨å¸ˆå…„ï¼Ÿè¿™â€¦â€¦ä¸»æ–™æ²¡é—®é¢˜ï¼Œä½†è¾…æ–™â€œé¾™æ¶è‰â€è¢«æ¢æˆäº†â€œåˆæ¬¢åƒå¶çº¢â€ï¼è¿™æ˜¯åˆæ¬¢å®—æµå‡ºçš„åŠ£è´¨å‚¬æƒ…è¾…æ–™â€¦â€¦æ˜¯å®‰å®šå³°é‡‡è´­çš„ã€‚", mood: 'worried' }, 
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆæ°”æåç¬‘ï¼Œç¬‘å®¹æ¸—äººï¼‰çœé’±ï¼Ÿä¼ æˆ‘æŒé—¨ä»¤ã€‚å°šæ¸…åæ»¥ç”¨èŒæƒï¼Œé‡‡è´­åŠ£è¯ï¼Œè‡´åŒé—¨å—å®³ï¼Œé™©é…¿å¤§ç¥¸ã€‚", mood: 'dark' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€å³æ—¥èµ·ï¼Œé©å»å°šæ¸…åå®‰å®šå³°å³°ä¸»åŠå¹´ä¿¸ç¦„ï¼Œç½šæ²¡ç§åº“å……å…¬ã€‚å‘½ä»–äº²è‡ªæ¸…ç†é‚£æ‰¹åŠ£è¯ï¼Œä¸€é¢—ä¸è®¸å‰©ã€‚", mood: 'dark' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€è¿˜æœ‰ï¼Œç¦è¶³å®‰å®šå³°ä¸‰ä¸ªæœˆï¼Œè®©ä»–æŠŠä»¥å‰æ‰€æœ‰è´¦ç›®é‡ç®—ä¸€éã€‚è‹¥å†æœ‰çº°æ¼ï¼Œæˆ‘å°±è®©ä»–å»ç™¾æˆ˜å³°ç»™æŸ³å¸ˆå¼Ÿå½“é™ªç»ƒã€‚", mood: 'determined' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆæŠšæ‘¸ç€è„–é¢ˆä¸Šçš„å»ç—•ï¼‰å°ä¹â€¦â€¦å“ªæ€•ç¿»éä¹å·ï¼Œæˆ‘ä¹Ÿè¦æ‰¾åˆ°ä½ ã€‚", mood: 'dark' },
                ]
            },
            chapter4: {
                id: 'chapter4',
                lines: [
                    { speaker: 'æ—ç™½', text: "ã€€ã€€ç¦»å¼€è‹ç©¹å±±åï¼Œæ²ˆæ¸…ç§‹åƒä¸€ç¼•ä¸çŸ¥å½’å¤„çš„æ¸¸é­‚ã€‚", mood: 'narrative', bg: BG_NUANHONG }, 
                    { speaker: 'æ—ç™½', text: "ã€€ã€€åŒè„šä¼¼æœ‰è‡ªæˆ‘æ„è¯†ï¼Œå…œå…œè½¬è½¬ï¼Œç»ˆæ˜¯å›åˆ°äº†é‚£åº§è§è¯äº†ä»–æ‰€æœ‰å‘å¾®ä¸ç»æœ›çš„å°åŸã€‚", mood: 'narrative' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€å¤œè‰²å¦‚å¢¨ï¼Œå‹¾æ ç“¦èˆé—´ç¬™æ­Œæ›¼èˆã€‚ä»–è¸å…¥äº†ä¸€å®¶åä¸ºâ€œæš–çº¢é˜â€çš„é’æ¥¼ã€‚", mood: 'narrative' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆéšæ‰‹æ·ä¸‹ä¸€é”­é“¶å­ï¼Œé¢å®¹æ†”æ‚´å´éš¾æ©è´µæ°”ï¼‰è¦æœ€å¥½çš„åŒ…é—´ã€‚æ‰¾ä¸ªçµç¶æŠ€è‰ºæœ€ç²¾çš„å§‘å¨˜æ¥ã€‚", mood: 'disdain' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€åŒ…é—´å†…ï¼Œé¦™æ°”ç”œè…»ã€‚", mood: 'narrative' },
                    { speaker: 'çµç¶å¥³', text: "ã€€ã€€ï¼ˆè§ä»–è¡£ç€ä¸å‡¡ï¼Œä¾¿æƒ³ä¾åä¸Šæ¥ï¼‰å…¬å­â€¦â€¦å¥´å®¶è¿™å°±ä¸ºæ‚¨â€¦â€¦", mood: 'neutral' }, 
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå†·å£°æ‰“æ–­ï¼Œä¾§èº«èººåœ¨è½¯æ¦»ä¸Šï¼ŒèƒŒå¯¹ç€å¥¹ï¼‰ç¦»æˆ‘è¿œç‚¹ã€‚å¼¹ä½ çš„æ›²å­ã€‚åˆ«è¯´è¯ï¼Œå°±è¿™æ ·ã€‚", mood: 'disdain' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€ã€éŸ³æ•ˆã€‘çµç¶å£°èµ·ï¼Œå¹½å’½å©‰è½¬ã€‚", mood: 'system', sound: SE_PIPA },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆé—­ä¸Šçœ¼ï¼Œå‘¼å¸æ¸æ¸å¹³ç¼“ï¼‰ï¼ˆå†…å¿ƒï¼‰è¿™ç§è„‚ç²‰æ°”â€¦â€¦ç”šè‡³å¸¦ç€äº›è®¸è…æœ½çš„å‘³é“â€¦â€¦", mood: 'soft' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå†…å¿ƒï¼‰çœŸå¥‡æ€ªã€‚åœ¨æ¸…é™å³°é—»æƒ¯äº†ç«¹é¦™å¢¨é¦™ï¼Œå¦‚ä»Šé—»åˆ°è¿™è‚¡å»‰ä»·çš„ä¿—å‘³ï¼Œåå€’è«åè§‰å¾—å¿ƒå®‰ã€‚", mood: 'soft' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå†…å¿ƒï¼‰ä»¿ä½›æˆ‘ä»æœªä¸Šè¿‡è‹ç©¹å±±ï¼Œä»æœªåšè¿‡é«˜é«˜åœ¨ä¸Šçš„å³°ä¸»ã€‚æˆ‘ä¾ç„¶æ˜¯é‚£ä¸ªåœ¨æ³¥æ²¼é‡Œæ‰“æ»šï¼Œåªé…æ‹¥æœ‰è¿™ç§å»‰ä»·æ¸©æŸ”çš„æ²ˆä¹ã€‚", mood: 'soft' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå˜´è§’å‹¾èµ·ä¸€æŠ¹è‡ªå˜²çš„å¼§åº¦ï¼‰çœ‹å•Šï¼Œæ²ˆä¹ï¼Œè¿™æ‰æ˜¯ä½ çš„å½’å®¿ã€‚çƒ‚æ³¥ï¼Œå°±è¯¥å¾…åœ¨çƒ‚æ³¥é‡Œã€‚", mood: 'despair' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€ã€é—ªå›ç”»é¢ã€‘æ˜¨å¤œå²³æ¸…æºæ·±æƒ…çš„çœ¼ç¥ï¼Œè€³è¾¹çš„å–˜æ¯ã€‚", mood: 'memory', bg: BG_BEDROOM }, 
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆæŒ‡èŠ‚çŒ›åœ°æŠ“ç´§èº«ä¸‹çš„é”¦è¤¥ï¼‰ï¼ˆå†…å¿ƒï¼‰é‚£å¤œçš„è’å”â€¦â€¦ä¸è¿‡æ˜¯è¯åŠ›ä½œç¥Ÿã€‚", mood: 'pain', bg: BG_NUANHONG }, 
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå†…å¿ƒï¼‰æ˜¯é‚£ä¼ªå›å­ä¸å¾—ä¸æ–½èˆçš„æ…ˆæ‚²ï¼Œæ˜¯ä¸ºäº†æ•‘ä¸€æ¡ç‹—å‘½è€Œä¸å¾—å·²ä¸ºä¹‹ã€‚", mood: 'pain' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå†…å¿ƒï¼‰å¯ç¬‘çš„æ˜¯â€¦â€¦ä½ ç«ŸçœŸçš„åœ¨é‚£ä¸€åˆ»åŠ¨äº†å¿ƒï¼Ÿç«ŸçœŸçš„åœ¨ä¸€å£°å£°â€œå°ä¹â€é‡Œç”Ÿå‡ºäº†æ»¡è¶³ï¼Ÿ", mood: 'pain' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå°†è„¸åŸ‹è¿›è‡‚å¼¯ï¼Œæµ‘èº«è½»é¢¤ï¼‰æ²ˆä¹â€¦â€¦ä½ å½“çœŸè´±å…¥éª¨é«“ã€‚è¿æœ€åä¸€ç‚¹å°Šä¸¥ï¼Œéƒ½è¦äº²æ‰‹ç¢¾ç¢ã€‚", mood: 'shame' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€è¿™ä¸€å¤œï¼Œä»–åœ¨çµç¶å£°ä¸­å½»å¤œæœªçœ ï¼Œä»»ç”±å¿ƒåº•çš„æ¯’è›‡å°†è‡ªå·±å•ƒå™¬å¾—é²œè¡€æ·‹æ¼“ã€‚", mood: 'narrative' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€å¤©åˆšç ´æ™“ï¼Œä»–æ¨å¼€é‚£å§‘å¨˜ï¼Œæ‰”ä¸‹èµé’±ã€‚æ»¡èº«è§ç´¢ï¼Œèµ°å‘åŸä¸œé‚£ç‰‡ç„¦é»‘çš„åºŸå¢Ÿã€‚", mood: 'narrative' },
                ]
            },
            chapter5: {
                id: 'chapter5',
                lines: [
                    { speaker: 'æ—ç™½', text: "ã€€ã€€ç§‹åºœåºŸå¢Ÿï¼Œç„¦é»‘çš„æ–­å£ã€‚æ²ˆæ¸…ç§‹åƒä¸€ç¼•æ¸¸é­‚ï¼Œå…œå…œè½¬è½¬å›åˆ°äº†é‚£ç‰‡ç„¦åœŸåºŸå¢Ÿã€‚", mood: 'narrative', bg: BG_RUIN },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå¯¹ç€åºŸå¢Ÿå˜¶å“‘ä½å¼ï¼‰ä¸ºä»€ä¹ˆâ€¦â€¦æ—¢å½“åˆå¼ƒæˆ‘ï¼Œå¦‚ä»Šåˆä½•å¿…å‡æƒºæƒºæ¥æ‹›æƒ¹ï¼", mood: 'despair' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆçªç„¶å‡ºç°ï¼Œæ‰£ä½ä»–çš„æ‰‹è…•ï¼‰æˆ‘ä¸æ”¾ã€‚ä½ è¿˜è¦èº²åˆ°å‡ æ—¶ï¼Ÿ", mood: 'sorrow' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆçœ¼å°¾æ³›çº¢ï¼Œå†·ç¬‘è®¥è®½ï¼‰å²³æŒé—¨è‹¥æ€•æˆ‘è´¥åè‹ç©¹å±±åå£°ï¼Œå¤§å¯æ¸…ç†é—¨æˆ·ï¼ä¼¼æˆ‘è¿™èˆ¬æµè¿çƒŸèŠ±æŸ³å··ä¹‹äººï¼Œæœ¬æ¥å°±è„â€¦â€¦", mood: 'disdain' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆä¸€å£°æš´å–ï¼‰ä½å£ï¼ä½ ä»¥ä¸ºé‚£æ™šæ˜¯æˆ‘æ•‘äº†ä½ ï¼Ÿå°ä¹ï¼Œé‚£æ˜¯ä½ åœ¨è‡ªæ•‘ï¼", mood: 'dark' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€æ˜¯ä½ å¿ƒé‡Œç»ˆäºè‚¯è®©æˆ‘é è¿‘ï¼Œè‚¯å“­ç€å–Šæˆ‘ä¸€å£°ä¸ƒå“¥â€¦â€¦ä½ é€ƒæ ¹æœ¬ä¸æ˜¯å› ä¸ºæ¨æˆ‘ï¼Œä½ æ˜¯æ¨ä½ è‡ªå·±ï¼", mood: 'dark' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå½»åº•å´©æºƒï¼‰é—­å˜´â€¦â€¦ä½ é—­å˜´ï¼ï¼", mood: 'shame' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆèµ¤çº¢ç€çœ¼ä¹æ±‚ï¼‰ä½ è‹¥è¿˜æœ‰æ¨ï¼Œæ‹”å‡ºç„è‚ƒå–æˆ‘æ€§å‘½ï¼åªæ±‚ä½ ï¼Œåˆ«å†ä½œè·µä½ è‡ªå·±ï¼", mood: 'sorrow' },
                ]
            },
            choice2: {
                id: 'choice2',
                question: "ç”Ÿæ­»æŠ‰æ‹©ï¼šæ²ˆæ¸…ç§‹çš„å‰‘å°–æŒ‡ç€å²³æ¸…æºã€‚",
                options: [
                    { id: 'A', text: "æ—¢ç„¶çŸ¥é“ï¼Œé‚£å°±å»æ­»ï¼", subtext: "ï¼ˆè¿›å…¥ True Routeï¼‰", style: "gold" },
                    { id: 'B', text: "åœæ‰‹ï¼Œè½¬èº«ç¦»å¼€", subtext: "ï¼ˆç»“å±€ï¼šé™Œè·¯ï¼‰", style: "gray" }
                ]
            },
            endingBE2: { 
                id: 'endingBE2', 
                text: "ã€€ã€€æ²ˆæ¸…ç§‹çœ‹ç€é€’è¿‡æ¥çš„ç„è‚ƒï¼Œå†·ç¬‘ä¸€å£°ï¼Œæ¨å¼€äº†å²³æ¸…æºçš„æ‰‹ã€‚ä»–è½¬èº«èµ°å…¥åºŸå¢Ÿæ·±å¤„ï¼Œä»æ­¤ä¿®çœŸç•Œå†æ— æ¸…é™å³°ä¸»ï¼Œåªæœ‰ä¸€ä¸ªæµæµªçš„æ®‹åºŸæ•£ä¿®ã€‚å²³æ¸…æºå®ˆç€è‹ç©¹å±±ï¼Œå­¤ç‹¬ç»ˆè€ã€‚\n\nã€Bad End: é™Œè·¯ã€‘", 
                mood: 'bad' 
            },
            chapter6: {
                id: 'chapter6',
                lines: [
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€æ—¢ç„¶çŸ¥é“ï¼Œé‚£å°±å»æ­»ï¼ï¼", mood: 'shame', bg: BG_RUIN },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€ã€éŸ³æ•ˆã€‘å—¡â€”â€”ï¼ï¼ï¼å‡„å‰çš„å‰‘é¸£ã€‚è¡€è‰²çµå…‰ç‚¸è£‚ï¼Œè¿›å…¥è®°å¿†é—ªå›ã€‚", mood: 'narrative', sound: SE_SWORD },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€å‰‘é”‹å³å°†è´¯ç©¿èƒ¸è†›çš„åˆ¹é‚£ï¼Œå²³æ¸…æºè…°é—´ç„è‚ƒå‰‘éª¤ç„¶å‘å‡ºä¸€å£°å‡„å‰æ‚²é¸£ï¼é‚£éæŠ¤ä¸»å‰‘æ°”ï¼Œè€Œæ˜¯çµé­‚æ·±å¤„çš„å…±é¸£ä¸å“€åšã€‚æ²ˆæ¸…ç§‹çš„ç¥è¯†è¢«å¼ºè¡Œæ‹½å…¥ä¸€ç‰‡æ··æ²Œçš„è®°å¿†ä¹‹æµ·ã€‚", mood: 'narrative', sound: SE_MAGIC },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€ã€è®°å¿†é—ªå›ã€‘â€œè‹¥æ— è·¯å¯èµ°ï¼Œä¾¿ä»¥å‘½å¼€è·¯ã€‚â€ å°‘å¹´å²³ä¸ƒä»¥å‘½å…¥å‰‘ï¼Œå£ä¸­æº¢è¡€ï¼Œå´åœ¨ç¬‘ï¼šâ€œå°ä¹â€¦â€¦ç­‰æˆ‘â€¦â€¦ä¸ƒå“¥æ¥äº†â€¦â€¦â€", mood: 'memory', bg: BG_LINGXI },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆå†·æ±—æ¹¿é€ï¼Œè·ªå€’åœ¨å°˜åŸƒé‡Œï¼‰è¿™å‰‘é¸£â€¦â€¦ç›´åˆ°è¿™ä¸€åˆ»ï¼Œæˆ‘æ‰ç»ˆäºå¬æ‡‚äº†è¿™å¥è¯â€¦â€¦â€œæ‹”å‡ºç„è‚ƒå–æˆ‘æ€§å‘½â€ã€‚", mood: 'shocked', bg: BG_RUIN },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€é‚£ä¸æ˜¯ä¸€æŠŠå‰‘ï¼Œé‚£æ˜¯å²³æ¸…æºçš„å‘½ï¼", mood: 'shocked' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€æ‰€æœ‰çš„æ€¨æ¨ã€åˆ»è–„ã€è‡ªåŒï¼Œåœ¨è¿™ä»½æ²‰é‡çª’æ¯çš„çœŸç›¸é¢å‰ï¼Œæ˜¾å¾—å¦‚æ­¤å¯ç¬‘è‹ç™½ã€‚", mood: 'narrative' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆé¢è‰²æƒ¨ç™½ï¼Œæ­£æ¬²è½¬èº«ç¦»å»ï¼‰â€¦â€¦", mood: 'sorrow' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆè·Œæ’ä¸Šå‰ï¼Œæ­»æ­»æ‰£ä½ä»–çš„è…°èƒŒï¼Œæ³ªæ°´æ±¹æ¶Œï¼‰ä¸ƒå“¥â€¦â€¦", mood: 'shocked' },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆæµ‘èº«å·¨éœ‡ï¼Œç‹ ç‹ å°†æ€€ä¸­äººæ‰è¿›éª¨è¡€ï¼‰æˆ‘åœ¨ã€‚å°ä¹ï¼Œæˆ‘ä»¬â€¦â€¦å›å®¶ã€‚å›è‹ç©¹å±±ã€‚", mood: 'gentle' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€å°˜åŸƒè½å®šã€‚å°šæ¸…åè¢«åºŸå»ä¿®ä¸ºæ‰“å…¥æ°´ç‰¢ã€‚è‹ç©¹å±±å¤œè‰²é‡å½’å®é™ã€‚æŒé—¨å¯æ®¿ï¼Œä»æ˜¯é‚£å¼ åºŠæ¦»ï¼Œæ°”æ°›å´æˆªç„¶ä¸åŒã€‚æ²ˆæ¸…ç§‹ä½“å†…ä½™æ¯’æ²‰ç§¯ï¼Œéœ€é åŒä¿®åŒ–è§£ã€‚", mood: 'narrative', bg: BG_BEDROOM },
                    { speaker: 'å²³æ¸…æº', text: "ã€€ã€€ï¼ˆæ‰‹æŒ‡è½»æŠšä»–çš„çœ‰çœ¼ï¼‰å°ä¹ï¼Œå¯èƒ½ä¼šæœ‰ç‚¹ç–¼ï¼Œå¿ä¸€å¿ã€‚", mood: 'gentle' },
                    { speaker: 'æ²ˆæ¸…ç§‹', text: "ã€€ã€€ï¼ˆç«æ¯›é¢¤äº†é¢¤ï¼Œè€³æ ¹å¾®çº¢ï¼‰å•°å—¦â€¦â€¦å¿«ç‚¹ã€‚", mood: 'soft' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€ã€CGã€‘æ²ˆæ¸…ç§‹ä»°èµ·å¤´ï¼Œç¬¨æ‹™è€Œåšå®šåœ°å»ä¸Šå²³æ¸…æºã€‚", mood: 'narrative', bg: ENDING_B_PIC },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€é‚£åœºç”±åŠ£è´¨ä¸¹è¯å¼•å‘çš„çƒˆç«ï¼Œæ›¾å·®ç‚¹å°†ä»–ä»¬ç„šæ¯ã€‚å¯æœ€ç»ˆï¼Œè¿™æŠŠç«çƒ§å°½äº†æ‰€æœ‰çš„è™šä¼ªã€éš”é˜‚ä¸è¯¯è§£ï¼Œå°†ä¸¤é¢—æ—©å·²åƒç–®ç™¾å­”çš„å¿ƒï¼Œé‡æ–°ç†”é“¸åœ¨äº†ä¸€èµ·ã€‚", mood: 'narrative' },
                    { speaker: 'æ—ç™½', text: "ã€€ã€€æƒ…ä¸çŸ¥æ‰€èµ·ï¼Œä¸€å¾€è€Œæ·±ã€‚æ¨ä¸çŸ¥æ‰€ç»ˆï¼Œä¸€ç¬‘è€Œæ³¯ã€‚", mood: 'narrative' },
                    { speaker: 'ç³»ç»Ÿ', text: "ã€€ã€€ã€Happy End: å½’é€”ã€‘", mood: 'success' },
                ]
            }
        };

        // --- 3. å­ç»„ä»¶ (å‰ç½®å®šä¹‰) ---
        const DialogueBox = ({ line, typedText, isTyping, handleClick, isLastEndingBLine }) => {
            const currentSpeaker = line ? line.speaker : '';
            const { name, color } = (() => {
                let color = "text-slate-400";
                if (currentSpeaker === "æ²ˆæ¸…ç§‹") color = "text-emerald-300";
                else if (currentSpeaker === "å²³æ¸…æº") color = "text-indigo-300";
                else if (currentSpeaker === "æœ¨æ¸…èŠ³") color = "text-green-200";
                else if (currentSpeaker === "çµç¶å¥³") color = "text-pink-300"; 
                else if (currentSpeaker === "ç³»ç»Ÿ") color = "text-sky-300";
                else if (currentSpeaker === "æ—ç™½") color = "text-amber-300";
                return { name: currentSpeaker, color };
            })();
            const isNarrative = ['æ—ç™½', 'ç³»ç»Ÿ', '', undefined].includes(name);

            return (
                <div className="relative w-full h-full">
                    {!isNarrative && (
                        <div className={`speaker-tag absolute bottom-full left-0 mb-[-1px] rounded-t-lg px-2 py-1 md:px-4 md:py-2 text-xs md:text-base font-bold transition-colors ${color}`} style={{ transform: 'translateY(-1px)' }}>{name}</div>
                    )}
                    <div onClick={handleClick} className={`dialogue-box-container p-3 md:p-6 relative h-full rounded-lg transition-all ${isLastEndingBLine ? 'cursor-default' : 'cursor-pointer hover:bg-opacity-95'} ${isNarrative ? 'border-cyan-600/50' : ''} ${name === 'æ²ˆæ¸…ç§‹' ? 'border-emerald-600' : name === 'å²³æ¸…æº' ? 'border-indigo-600' : ''}`}>
                        <p className={`dialogue-text text-xs sm:text-sm md:text-lg lg:text-2xl leading-snug md:leading-relaxed text-slate-100 h-full overflow-y-auto pr-1 pb-5 scrollbar-thin ${isNarrative ? 'italic text-xs md:text-base lg:text-xl text-slate-300' : 'font-semibold'}`}>
                            {typedText}
                            {(!isLastEndingBLine && isTyping) && <span className="animate-pulse inline-block ml-1 w-1.5 h-4 md:w-2 md:h-6 bg-cyan-400 align-middle"></span>}
                        </p>
                        {!isLastEndingBLine && !isTyping && typedText.length === (line ? line.text.length : 0) && (
                            <div className="absolute bottom-1 right-2 md:bottom-2 md:right-3 text-[10px] md:text-xs text-cyan-500 font-mono animate-bounce">ç‚¹å‡»ç»§ç»­ (â–¼)</div>
                        )}
                    </div>
                </div>
            );
        };

        const GameMenu = ({ isOpen, onClose, onSave, onLoad, onReset }) => {
            if (!isOpen) return null;
            return (
                <div className="absolute inset-0 z-40 bg-slate-950/80 backdrop-blur-sm flex items-center justify-center animate-in fade-in duration-300 p-4">
                    <div className="w-full max-w-sm bg-slate-900/95 border border-cyan-700 rounded-lg p-4 md:p-6 shadow-2xl space-y-3 md:space-y-4">
                        <h3 className="text-xl md:text-2xl font-bold text-cyan-400 mb-4 md:mb-6 border-b border-cyan-800 pb-2">æ¸¸æˆèœå•</h3>
                        <button onClick={onSave} className="w-full flex items-center justify-center gap-3 p-3 md:p-4 bg-cyan-700/30 hover:bg-cyan-600/50 text-white rounded-lg transition-all border border-cyan-600 text-sm md:text-base"><Save size={18} className="md:w-5 md:h-5" /> æœ¬åœ°å­˜æ¡£</button>
                        <button onClick={onLoad} className="w-full flex items-center justify-center gap-3 p-3 md:p-4 bg-indigo-700/30 hover:bg-indigo-600/50 text-white rounded-lg transition-all border border-indigo-600 text-sm md:text-base"><Upload size={18} className="md:w-5 md:h-5" /> æœ¬åœ°è¯»æ¡£</button>
                        <button onClick={onReset} className="w-full flex items-center justify-center gap-3 p-3 md:p-4 bg-red-700/30 hover:bg-red-600/50 text-white rounded-lg transition-all border border-red-600 text-sm md:text-base"><RefreshCcw size={18} className="md:w-5 md:h-5" /> ä»å¤´å¼€å§‹</button>
                        <button onClick={onClose} className="w-full mt-4 md:mt-6 p-2 md:p-3 bg-slate-700/50 hover:bg-slate-600/70 text-slate-300 rounded-lg transition-all text-sm md:text-base">è¿”å›æ¸¸æˆ</button>
                    </div>
                </div>
            );
        };

        const MessageToast = ({ message }) => {
            if (!message) return null;
            const style = message.type === 'success' ? "bg-green-700 border-green-500" : message.type === 'error' ? "bg-red-700 border-red-500" : "bg-yellow-700 border-yellow-500";
            return (
                <div className={`fixed top-4 left-1/2 -translate-x-1/2 p-3 rounded-lg shadow-xl z-50 transition-all duration-300 flex items-center gap-2 text-white border ${style}`}>
                    <span className="font-semibold text-sm">{message.text}</span>
                </div>
            );
        };

        // --- 4. Main Game Component ---
        const Game = () => {
            // --- Helper: åŒæ­¥è¯»å– LocalStorage ---
            const loadAutoSave = () => {
                try {
                    const saved = localStorage.getItem(SAVE_KEY_AUTO);
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        if (parsed && parsed.scene && parsed.scene !== 'start') {
                            return parsed;
                        }
                    }
                } catch(e) { console.error("Auto-save load error:", e); }
                return null;
            };

            // è·å–åˆå§‹çŠ¶æ€
            const initialState = loadAutoSave() || {
                scene: 'start',
                dialogueIndex: 0,
                currentBg: BG_QINGJING
            };

            // --- Game State (ç›´æ¥åˆå§‹åŒ–) ---
            const [scene, setScene] = React.useState(initialState.scene);
            const [dialogueIndex, setDialogueIndex] = React.useState(initialState.dialogueIndex);
            const [currentBg, setCurrentBg] = React.useState(initialState.currentBg);

            const [typedText, setTypedText] = React.useState('');
            const [isTyping, setIsTyping] = React.useState(false);
            const [isMenuOpen, setIsMenuOpen] = React.useState(false);
            const [message, setMessage] = React.useState(null); 
            
            const [hasSave, setHasSave] = React.useState(() => !!localStorage.getItem(SAVE_KEY_MANUAL));
            
            const { isPlaying, play, toggle } = useAudio(BGM_URL);
            const audioCache = React.useRef({});

            // --- é¢„åŠ è½½ ---
            React.useEffect(() => {
                const images = [BG_QINGJING, BG_QIANCAO, BG_BAMBOO_NIGHT, BG_COLD_SPRING, BG_BEDROOM, BG_RUIN, BG_LINGXI, BG_NUANHONG, SHEN_QINGQIU_PIC, YUE_QINGYUAN_PIC, ENDING_B_PIC, START_SCREEN_PIC];
                images.forEach(src => { const img = new Image(); img.src = src; });
                const sounds = [SE_BOOM, SE_FAN, SE_SPLASH, SE_CLOTH, SE_SWORD, SE_MAGIC, SE_PIPA];
                sounds.forEach(src => { const a = new Audio(src); a.preload = 'auto'; a.load(); audioCache.current[src] = a; });
            }, []);

            // --- æ ¸å¿ƒï¼šç»Ÿä¸€çš„çŠ¶æ€æ›´æ–°å‡½æ•° (åŒæ­¥å†™å…¥å­˜æ¡£) ---
            const updateGameState = (newScene, newIndex, newBg) => {
                setScene(newScene);
                setDialogueIndex(newIndex);
                if (newBg) setCurrentBg(newBg);

                if (newScene !== 'start') {
                    const saveData = {
                        scene: newScene,
                        dialogueIndex: newIndex,
                        currentBg: newBg || currentBg, 
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem(SAVE_KEY_AUTO, JSON.stringify(saveData));
                }
            };

            const displayMessage = (text, type = 'info', duration = 3000) => {
                setMessage({ text, type });
                setTimeout(() => setMessage(null), duration);
            };

            // å­˜æ¡£å‡½æ•°å®šä¹‰åœ¨ return ä¹‹å‰
            const saveGameState = () => {
                const gameState = { scene, dialogueIndex, currentBg, timestamp: new Date().toISOString() };
                try {
                    localStorage.setItem(SAVE_KEY_MANUAL, JSON.stringify(gameState));
                    displayMessage("å­˜æ¡£æˆåŠŸï¼(æœ¬åœ°)", 'success');
                    setHasSave(true);
                } catch (e) {
                    displayMessage("å­˜æ¡£å¤±è´¥", 'error');
                }
            };

            const loadGameState = () => {
                try {
                    const savedData = localStorage.getItem(SAVE_KEY_MANUAL);
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        if (SCENES[data.scene]) {
                            updateGameState(data.scene, data.dialogueIndex, data.currentBg);
                            displayMessage("è¯»æ¡£æˆåŠŸï¼", 'success');
                            setIsMenuOpen(false);
                        } else {
                            displayMessage("å­˜æ¡£æ•°æ®ä¸å…¼å®¹ã€‚", 'error');
                        }
                    } else {
                        displayMessage("æ²¡æœ‰æ‰¾åˆ°æœ¬åœ°å­˜æ¡£ã€‚", 'warning');
                    }
                } catch (e) {
                    displayMessage("è¯»æ¡£å¤±è´¥", 'error');
                }
            };
            
            const resetGame = () => {
                localStorage.removeItem(SAVE_KEY_AUTO);
                setScene('start');
                setDialogueIndex(0);
                setCurrentBg(BG_QINGJING);
                setIsMenuOpen(false);
            };

            // é€»è¾‘å¤„ç†
            const handleNext = () => {
                if (isTyping) {
                    let fullText = "";
                    if (SCENES[scene]?.lines) fullText = SCENES[scene].lines[dialogueIndex].text;
                    else if (SCENES[scene]?.text) fullText = SCENES[scene].text;
                    setTypedText(fullText);
                    setIsTyping(false);
                    return;
                }

                if (SCENES[scene] && SCENES[scene].lines) {
                    if (dialogueIndex < SCENES[scene].lines.length - 1) {
                        const nextIndex = dialogueIndex + 1;
                        const nextLine = SCENES[scene].lines[nextIndex];
                        updateGameState(scene, nextIndex, nextLine.bg); 
                    } else {
                        // ç« èŠ‚è·³è½¬é€»è¾‘æ›´æ–°
                        let nextScene = '';
                        if (scene === 'chapter1') nextScene = 'chapter2';
                        else if (scene === 'chapter2') nextScene = 'choice1';
                        else if (scene === 'chapter3') nextScene = 'chapter4';
                        else if (scene === 'chapter4') nextScene = 'chapter5'; 
                        else if (scene === 'chapter5') nextScene = 'choice2';  
                        
                        if (nextScene) {
                             const firstLineBg = SCENES[nextScene]?.lines?.[0]?.bg;
                             updateGameState(nextScene, 0, firstLineBg);
                        }
                    }
                } 
            };

            const handleChoice = (option) => {
                let nextScene = '';
                if (scene === 'choice1') {
                    nextScene = (option === 'A') ? 'endingBE1' : 'chapter3';
                } else if (scene === 'choice2') {
                    nextScene = (option === 'A') ? 'chapter6' : 'endingBE2'; 
                }
                
                if (nextScene) {
                    const firstLineBg = SCENES[nextScene]?.lines?.[0]?.bg;
                    const endingBg = (nextScene.startsWith('ending')) ? null : firstLineBg;
                    updateGameState(nextScene, 0, endingBg);
                }
            };

            const startGame = (manualLoad = false) => {
                if (manualLoad) {
                    loadGameState();
                } else {
                    localStorage.removeItem(SAVE_KEY_AUTO);
                    updateGameState('chapter1', 0, BG_QIANCAO);
                }
            }

            // Effects
            React.useEffect(() => {
                if (SCENES[scene]?.lines && dialogueIndex >= SCENES[scene].lines.length) setDialogueIndex(0);
            }, [scene]);

            React.useEffect(() => {
                const currentLine = SCENES[scene]?.lines?.[dialogueIndex];
                if (currentLine && currentLine.sound) {
                    const soundSrc = currentLine.sound;
                    const audio = audioCache.current[soundSrc] || new Audio(soundSrc);
                    audio.currentTime = 0;
                    audio.play().catch(e => {});
                }
            }, [scene, dialogueIndex]);

            React.useEffect(() => {
                let currentText = "";
                if (SCENES[scene]?.lines) {
                    const line = SCENES[scene].lines[dialogueIndex];
                    currentText = line ? line.text : ""; 
                } else if (SCENES[scene]?.text) {
                    currentText = SCENES[scene].text;
                } else return;

                setTypedText('');
                setIsTyping(true);
                let charIndex = 0;
                const timer = setInterval(() => {
                    if (charIndex < currentText.length) {
                        charIndex++;
                        setTypedText(currentText.substring(0, charIndex));
                    } else {
                        setIsTyping(false);
                        clearInterval(timer);
                    }
                }, 30);
                return () => clearInterval(timer);
            }, [dialogueIndex, scene]);

            return (
                <div className="w-full h-screen bg-slate-950 text-cyan-50 font-sans overflow-hidden relative flex items-center justify-center select-none p-4">
                    <MessageToast message={message} />
                    
                    <button onClick={toggle} className="absolute bottom-4 right-4 z-50 p-3 rounded-full bg-slate-800/70 text-cyan-500 hover:bg-slate-700/90 transition-all border border-cyan-800 shadow-lg" title={isPlaying ? "æš‚åœèƒŒæ™¯éŸ³ä¹" : "æ’­æ”¾èƒŒæ™¯éŸ³ä¹"} style={{ zIndex: 60 }}>
                        {isPlaying ? <Volume2 size={24} /> : <VolumeX size={24} />}
                    </button>
                    
                    {(scene !== 'start' && !scene.startsWith('ending')) && (
                        <button onClick={() => setIsMenuOpen(true)} className="absolute top-4 left-4 z-30 p-3 rounded-full bg-slate-800/70 text-cyan-500 hover:bg-slate-700/90 transition-all border border-cyan-800 shadow-lg" title="æ¸¸æˆèœå•" style={{ zIndex: 60 }}>
                            <Menu size={24} />
                        </button>
                    )}

                    <div id="game-frame" className="aspect-[16/9] w-full max-h-full shadow-2xl rounded-xl relative overflow-hidden bg-black" style={{ maxWidth: 'calc((100vh - 2rem) * 16 / 9)' }}>
                        <div className="absolute inset-0 pointer-events-none opacity-20 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 via-slate-950 to-black"></div>
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-50"></div>

                        {scene === 'start' && (
                            <div className="absolute inset-0 z-10 flex items-center justify-center">
                                <img src={START_SCREEN_PIC} alt="æ¸¸æˆå¼€å§‹ç”»é¢" className="absolute inset-0 w-full h-full object-cover transition-opacity duration-1000" onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/1920x1080/0d0d1a/ffffff?text=æ¸¸æˆå¼€å§‹ç”»é¢"; }} />
                                <div className="absolute inset-0 bg-black/50"></div>
                                <div className="z-20 text-center animate-in fade-in zoom-in duration-700 p-4 md:p-8 w-full max-w-2xl h-full flex flex-col items-center justify-center">
                                    <h1 className="font-calligraphy text-4xl sm:text-5xl md:text-6xl tracking-widest text-stone-100 drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)] leading-tight md:leading-relaxed">
                                        å®‰å®šå³°é‡‡è´­å‡è¯<br/>å¼•å‘çš„æƒ¨æ¡ˆ
                                    </h1>
                                    <div className="space-y-4 md:space-y-6 pt-6 md:pt-10 flex flex-col items-center w-full">
                                        <button onClick={() => startGame(false)} className="font-calligraphy text-xl md:text-3xl px-8 py-2 md:px-12 md:py-3 bg-black/60 border-2 border-stone-500 text-stone-100 hover:bg-black/80 hover:text-white hover:border-stone-300 transition-all duration-500 rounded-sm shadow-lg tracking-widest w-72 md:w-96">
                                            [ å¼€å§‹æ–°æ¸¸æˆ ]
                                        </button>
                                        {hasSave && (
                                            <button onClick={() => startGame(true)} className="font-calligraphy text-xl md:text-3xl px-8 py-2 md:px-12 md:py-3 bg-stone-900/60 border-2 border-stone-600 text-stone-300 hover:bg-stone-900/80 hover:text-white hover:border-stone-400 transition-all duration-500 rounded-sm shadow-lg tracking-widest w-72 md:w-96">
                                                [ ç»§ç»­æ¸¸æˆ ]
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {(scene.startsWith('chapter') || scene.startsWith('ending')) && (() => {
                            const isEndingScene = scene.startsWith('ending');
                            const currentLines = SCENES[scene]?.lines || [];
                            const currentLine = isEndingScene && !SCENES[scene].lines ? { speaker: '', text: SCENES[scene].text } : (currentLines[dialogueIndex] || { speaker: '', text: '' });
                            const isLastLine = isEndingScene && !SCENES[scene].lines ? true : (dialogueIndex === currentLines.length - 1);
                            const handleClick = isEndingScene && isLastLine ? resetGame : handleNext;
                            const speakingCharacter = currentLine.speaker;

                            return (
                                <div className="absolute inset-0 w-full h-full">
                                    <div className="absolute inset-0 rounded-xl overflow-hidden">
                                        {currentBg && <img src={currentBg} className="absolute inset-0 w-full h-full object-cover transition-all duration-1000" style={{ filter: 'brightness(0.5) contrast(1.1)' }} />}
                                        {!currentBg && <div className="absolute inset-0 bg-black"></div>}
                                        <div className="absolute inset-0 bg-slate-950/40"></div>
                                    </div>
                                    <div className="absolute top-0 w-full h-[75%] flex items-end justify-center pt-16 gap-12">
                                        <div className={`relative h-full transition-all duration-500 ease-out transform ${speakingCharacter === 'å²³æ¸…æº' ? 'opacity-100 translate-y-0 scale-100' : 'opacity-0 translate-y-8 scale-95'} max-h-full w-1/3`}>
                                            <img src={YUE_QINGYUAN_PIC} className="character-visual absolute bottom-0 left-1/2 -translate-x-1/2" />
                                        </div>
                                        <div className={`relative h-full transition-all duration-500 ease-out transform ${speakingCharacter === 'æ²ˆæ¸…ç§‹' ? 'opacity-100 translate-y-0 scale-100' : 'opacity-0 translate-y-8 scale-95'} max-h-full w-1/3`}>
                                            <img src={SHEN_QINGQIU_PIC} className="character-visual absolute bottom-0 left-1/2 -translate-x-1/2" />
                                        </div>
                                    </div>
                                    {scene === 'endingBE2' && isLastLine && !isTyping && (
                                         <div className="absolute inset-0 z-30 w-full flex items-center justify-center animate-in fade-in duration-1000 bg-black/90">
                                            <div className="text-center">
                                                <h2 className="text-4xl font-bold text-slate-500 mb-4">ç»“å±€è¾¾æˆ</h2>
                                                <p className="text-xl text-slate-400 mb-8">é™Œè·¯</p>
                                                <button onClick={resetGame} className="px-6 py-2 border border-slate-500 text-slate-300 hover:bg-slate-800 rounded">è¿”å›æ ‡é¢˜</button>
                                            </div>
                                         </div>
                                    )}
                                    {scene === 'endingBE1' && isLastLine && !isTyping && (
                                         <div className="absolute inset-0 z-30 w-full flex items-center justify-center animate-in fade-in duration-1000 bg-black/90">
                                            <div className="text-center">
                                                <h2 className="text-4xl font-bold text-slate-500 mb-4">ç»“å±€è¾¾æˆ</h2>
                                                <p className="text-xl text-slate-400 mb-8">é˜´é˜³ä¸¤éš”</p>
                                                <button onClick={resetGame} className="px-6 py-2 border border-slate-500 text-slate-300 hover:bg-slate-800 rounded">è¿”å›æ ‡é¢˜</button>
                                            </div>
                                         </div>
                                    )}
                                    {scene === 'chapter6' && isLastLine && !isTyping && (
                                         <div className="absolute inset-0 z-30 w-full flex items-center justify-center animate-in fade-in duration-1000 bg-black/90">
                                            <div className="text-center">
                                                <h2 className="text-4xl font-bold text-amber-500 mb-4">ç»“å±€è¾¾æˆ</h2>
                                                <p className="text-xl text-amber-200 mb-8">å½’é€”</p>
                                                <button onClick={resetGame} className="px-6 py-2 border border-amber-500 text-amber-200 hover:bg-amber-900/50 rounded transition-colors duration-300">è¿”å›æ ‡é¢˜</button>
                                            </div>
                                         </div>
                                    )}
                                    <div className="absolute bottom-0 w-full h-[32%] md:h-[25%] px-2 pb-2 md:px-8 md:pb-4 z-20">
                                        <DialogueBox line={currentLine} typedText={typedText} isTyping={isTyping} handleClick={handleClick} isLastEndingBLine={isEndingScene && isLastLine} />
                                    </div>
                                </div>
                            );
                        })()}

                        {(scene === 'choice1' || scene === 'choice2') && (
                            <div className="z-20 absolute inset-0 bg-slate-950/90 backdrop-blur-sm flex items-center justify-center p-2 md:p-6">
                            <div className="w-full max-w-sm md:max-w-2xl max-h-full flex flex-col border-2 md:border-4 border-red-500/50 bg-slate-950 p-1 md:p-2 shadow-[0_0_20px_rgba(220,38,38,0.3)] animate-in zoom-in duration-300">
                                <div className="bg-slate-900 p-2 md:p-8 border border-red-900/30 relative overflow-y-auto flex-1 flex flex-col justify-center scrollbar-thin">
                                    <div className="flex items-center justify-center gap-2 md:gap-4 text-red-400 mb-1 md:mb-8 pb-1 md:pb-4 border-b border-red-900/70 shrink-0">
                                        <AlertTriangle size={16} className="animate-pulse md:w-8 md:h-8" />
                                        <h2 className="text-base md:text-3xl font-extrabold tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-red-200 to-red-600">å‘½è¿æŠ‰æ‹©</h2>
                                    </div>
                                    <p className="text-slate-300 mb-2 md:mb-10 text-xs md:text-lg text-center font-serif leading-snug shrink-0">{SCENES[scene].question}</p>
                                    <div className="grid grid-cols-2 md:grid-cols-1 gap-2 md:gap-6 w-full">
                                        {SCENES[scene].options.map((option) => (
                                            <button 
                                                key={option.id}
                                                onClick={() => handleChoice(option.id)} 
                                                className="w-full text-left p-2 md:p-5 border border-slate-600 bg-slate-800/50 hover:bg-slate-700/80 hover:border-cyan-500/50 transition-all duration-300 rounded text-xs md:text-lg font-semibold group relative overflow-hidden flex flex-col justify-center h-full"
                                            >
                                                <div className="absolute inset-0 bg-cyan-900/20 translate-y-[100%] group-hover:translate-y-0 transition-transform duration-300"></div>
                                                <div className="relative z-10">
                                                    <div className="text-slate-300 group-hover:text-cyan-50 leading-tight">
                                                        {option.id}. {option.text}
                                                    </div>
                                                    <div className="text-[9px] md:text-xs text-slate-500 group-hover:text-cyan-200/70 mt-0.5 md:mt-1 font-mono leading-none">
                                                        {option.subtext}
                                                    </div>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            </div>
                        )}

                        <GameMenu isOpen={isMenuOpen} onClose={() => setIsMenuOpen(false)} onSave={saveGameState} onLoad={loadGameState} onReset={resetGame} />
                        <div className="pointer-events-none absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%)] z-50 bg-[length:100%_2px] opacity-10"></div>
                    </div>
                </div>
            );
        };

        window.addEventListener('load', () => {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<Game />);
        });
    </script>
</body>
</html>
